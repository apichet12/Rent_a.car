import React, { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import './Auth.css';

const advantagesWithIcons = [
  { icon: 'üí∞', text: '‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡πâ‡∏≤‡∏á' },
  { icon: 'üìÑ', text: '‡∏°‡∏µ‡πÉ‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏ß‡∏¥‡∏ä‡∏≤‡∏ä‡∏µ‡∏û' },
  { icon: 'üîÑ', text: '‡∏ú‡∏¥‡∏î‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏á‡∏¥‡∏ô' },
  { icon: 'üó®Ô∏è', text: '‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ï‡∏•‡∏≠‡∏î‡∏Å‡∏≤‡∏£‡∏à‡πâ‡∏≤‡∏á' },
  { icon: '‚úÖ', text: '‡∏ü‡∏£‡∏µ‡πÅ‡∏•‡∏ô‡∏ã‡πå‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö' }
];

const Register = () => {
  const navigate = useNavigate();
  const [form, setForm] = useState({ username: '', email: '', password: '', confirmPassword: '', name: '' });
  const [error, setError] = useState('');
  const [wantsOffers, setWantsOffers] = useState(true);

  const handleChange = e => setForm({ ...form, [e.target.name]: e.target.value });

  const handleSubmit = async (e) => {
    e.preventDefault();
    setError('');

    if (form.password !== form.confirmPassword) {
      setError('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô');
      return;
    }

    try {
      const payload = {
        username: form.username,
        password: form.password,
        name: form.name || null,
        email: form.email || null
      };

      const res = await fetch('http://localhost:5000/api/register', {
        method: 'POST',
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });

      const data = await res.json();

      if (data.success) {
        alert(data.message || '‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
        navigate('/');
      } else {
        setError(data.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏');
      }
    } catch (err) {
      console.error('Register fetch error:', err);
      setError('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå');
    }
  };

  return (
    <div style={{ display: 'flex', justifyContent: 'center', padding: 24, minHeight: '100vh', background: '#f9fafb' }}>
      <div className="auth-card">
        <div className="auth-left">
          <img src="/logo192.png" alt="logo" style={{ width: 120, display: 'block', margin: '0 auto' }} />
          <h3 style={{ color: '#07203a', textAlign: 'center', marginTop: 8 }}>‡∏Ç‡πâ‡∏≠‡∏î‡∏µ‡∏Ç‡∏≠‡∏á‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏≤</h3>
          <div className="advantages">
            {advantagesWithIcons.map((adv, i) => (
              <div key={i} className="adv-item">
                <div className="adv-icon">{adv.icon}</div>
                <div style={{ fontWeight: 600 }}>{adv.text}</div>
              </div>
            ))}
          </div>
        </div>

        <div className="auth-right">
          <h2 style={{ color: '#07203a', marginBottom: 12, textAlign: 'center' }}>‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h2>
          {error && <div style={{ background: '#fff1f2', color: '#991b1b', padding: 10, borderRadius: 8, marginBottom: 12 }}>{error}</div>}

          <form onSubmit={handleSubmit} style={{ display: 'grid', gap: 12 }}>
            <input name="username" className="nice-input" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ / Username" value={form.username} onChange={handleChange} required />
            <input name="email" className="nice-input" type="email" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏• / Email" value={form.email} onChange={handleChange} required />
            <input name="name" className="nice-input" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏• (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)" value={form.name} onChange={handleChange} />

            <input name="password" className="nice-input" type="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" value={form.password} onChange={handleChange} required />
            <input name="confirmPassword" className="nice-input" type="password" placeholder="‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" value={form.confirmPassword} onChange={handleChange} required />

            <label style={{ display: 'flex', alignItems: 'center', gap: 8 }}>
              <div role="button" tabIndex={0} className={`toggle-circle ${wantsOffers ? 'on' : ''}`} onClick={() => setWantsOffers(v => !v)} onKeyDown={() => setWantsOffers(v => !v)}>{wantsOffers ? '‚úì' : ''}</div>
              <div>‡∏ï‡∏Å‡∏•‡∏á‡∏£‡∏±‡∏ö‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡∏û‡∏¥‡πÄ‡∏®‡∏©</div>
            </label>

            <button type="submit" className="btn-primary" style={{ width: '100%', padding: 12, borderRadius: 8, fontWeight: 700 }}>‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
          </form>

          <div style={{ marginTop: 16, width: '100%' }}>
            <p style={{ color: '#6b7280', marginBottom: 12, textAlign: 'center' }}>‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏î‡πâ‡∏ß‡∏¢</p>
            <button className="social-btn" style={{ marginBottom: 10 }} onClick={() => alert('‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏î‡πâ‡∏ß‡∏¢ Facebook')}>üîµ Facebook</button>
            <button className="social-btn" onClick={() => alert('‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏î‡πâ‡∏ß‡∏¢ Google')}>üü¢ Google</button>
          </div>

          <div style={{ textAlign: 'center', marginTop: 12 }}>‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏•‡πâ‡∏ß? <a href="/login" className="small-link">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</a></div>
        </div>
      </div>
    </div>
  );
};

export default Register;
